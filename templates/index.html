<!DOCTYPE html>
<html>
<head>
    <title>Blackjack</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!--
    <div id="mode-selection">
        <button id="learn-button"><img src="{{ url_for('static', filename='images/learn_button.png') }}" alt="学習 Phase1"></button>
        <button id="learn2-button"><img src="{{ url_for('static', filename='images/nextlearn_button.png') }}" alt="学習 Phase2"></button>
    </div>
    -->

    <div id="play-selection">
        
        <button id="play-button"><img src="{{ url_for('static', filename='images/play_button.png') }}" alt="プレイ"></button>
    </div>

    <!-- サイトの注意メッセージ -->
    <div id="warning-message" class="warning">
        これは実験用です。AIのターンで2連続引いてしまうなど、正常な挙動をしないことが確認できています
    </div>

    <!-- 注意メッセージ2 -->
    <div id="warningtwo-message" class="warningtwo">
        管理者の許可およびメンテナンスがない限り、「学習ボタン」は表示されません。
    </div>

    <!-- ブラックジャック(21)の基本ルール説明 -->
    <div id="rules-section">
        <h2>このサイトでの、ブラックジャック(21)の基本ルール</h2>
        <p>
            ・カードは1～11まであり、<span class="update-highlight">合計が21に近いほうが勝ち</span>です。<br>
            ・<span class="update-highlight">山札は共通</span>です。つまり、1度引いた(引かれた)カードはもう1度出てくることはありません。<br>
            ・どちらもバーストしている場合、それぞれのプレイヤーの手札合計が<span class="text-attention-red">21から遠いほうが(負け)</span>となります。<br>
            ・あなたは引くか、引かないかを選択して進めます。<br>
            ・人間が先行とします。<br>
            
            ・<span class="update-highlight">両者がスタンドを3回連続選んだ時点で勝敗判定</span>します。<br>
            ・本サイトではAI挙動が不安定な部分がありますが、ご了承ください。<br>
            ・AIはQテーブル方式です。事前学習された確率に基づき場の状況を見ながら引くか引かないかを決めます。<br>

            <strong>──2025-03-26以降の更新──</strong><br>
            試合中にポイントを賭けるシステムを追加しました。勝てそうなら「宣言型SPカード」を使用し、相手の命を減らすことができます<br>
            また試合中AI側の手札表示で”初期カードだけを試合終了まで隠す”ように変更しました<br>
            <strong>──2025-06-26以降の更新──</strong><br>
            どちらかがバーストした瞬間に、強制的に勝敗判定が行われてしまう仕様を変更し、試合を継続するように<br>
            メッセージボックスにおけるAI側の合計表示を試合終了まで削除<br>
            そのほかAI側にハードコード型の思考判断改良を実施<br>
            SPカードの種類を拡充(最後に引いた手札カードを山札に戻せる即時発動SPカードを追加しました)<br>
            <strong>──今後の改良案──</strong><br>
            Q学習エンジンの報酬改善や重み変更、AI側がSPカードを発動するときの条件を強化等<br>
        </p>
    </div>

    <!-- その他説明 -->
    <div id="ruletwo-section">
        <h2>Python本体(AI思考部)はAlph496とGemini 2.5の共同作業で書かれました</h2>
        <p>
            学習時には、1段階目でルールベースのAIとQ学習が自動対戦され、2段階目で訓練済みQ学習同士が自己対戦しています。<br>
            すでに学習済みなのでそのままプレイできます。<br>
            ローカルで動かしたい場合はGithubで公開することも考えます。<br>
            HTML、CSS、JavaScriptもGPT-4 o3miniやGeminiに殆ど書かせています。<br>
        </p>
    </div>
    
    
    <div id="game-container" style="display: none;">
        <div id="ai-area">
            <h2>AIの手札:</h2>
            <div>AIのポイント: <span id="ai-points">--</span></div>
            
            <!-- AIのSPカード表示エリアを追加 -->
            <div id="ai-sp-cards-area" style="font-size: 0.8em; margin-top: 5px;">
                AI SPカード: <span id="ai-sp-card-list">なし</span>
            </div>
            <!--ここまで -->
            <!-- AI宣言中表示を追加 -->
            <div id="ai-declared-sp-card-display" style="font-weight: bold; font-size: 0.9em;">
                AI宣言中: <span id="ai-declared-card-name">なし</span>
            </div>
            <!-- ここまで -->
            
            <div id="ai-hand"></div>
        </div>

        <div id="player-area">
            <h2>あなたの手札:</h2>
            <div>あなたのポイント: <span id="player-points">--</span></div>
            <div id="player-sp-cards-area">
                <h3>SPカード:</h3>
                <!-- プレイヤーの宣言中カード表示 (これはこのままでOK) -->
                <div id="declared-sp-card-display" style="margin-bottom: 5px; font-weight: bold;">
                    宣言中: <span id="declared-card-name">なし</span>
                </div>
                
                <!-- 2025-0626以降の変更点 -->
                <h4>即時発動SPカード:</h4>
                <div id="instant-sp-cards" class="sp-card-category">
                    <!-- ここに即時発動系SPカードがリスト表示されます -->
                    <p>なし</p> 
                </div>

                <h4>宣言型SPカード:</h4>
                <div id="declarable-sp-cards" class="sp-card-category">
                    <!-- ここに宣言系SPカードがリスト表示されます -->
                    <p>なし</p>
                </div>
                <!--ここまで-->

            </div>
            <div id="player-hand"></div>
        </div>

        <div id="buttons">
            <!-- 終了ボタンを追加(完全リセット-プレイモード画面に戻る) -->
            <button id="reset-all-button" style="margin-bottom: 20px;"> <!-- 上下の間隔調整 -->
                <img src="{{ url_for('static', filename='images/end_button.png') }}" alt="終了してリセット">
                <!-- 画像サイズは適宜調整 -->
            </button>
            <!-- ここまで -->
            <button id="hit-button">
                <img src="{{ url_for('static', filename='images/hit_button.png') }}" alt="ヒット">
            </button>
            <button id="stand-button">
                <img src="{{ url_for('static', filename='images/stand_button.png') }}" alt="スタンド">
            </button>
        </div>

        <!-- メッセージログ表示エリア -->
        <div id="message-log"></div>

        <div id="end-game" style="display: none;">
            <!-- 終了ではなくゲームを続ける -->
            <button id="next-game-button">
                <img src="{{ url_for('static', filename='images/next_game_button.png') }}" alt="次のゲームへ">
            </button>
            <!-- ここまで -->
        </div>

    </div>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
